<?xml version="1.0" encoding="UTF-8" ?>
<ReportDataSource><Report reporteId="" reportName="合同完成率统计"/><fieldInfo><field fieldname="CRMSaleContract.SignUpDate" AsfieldName="startDate" groupByFlag="0" displayFlag="0" condition="&gt;=?" conditionJoin="and" orderbyFlag="" display="签约日期≥" fieldType="5" inputType="0" popUpName="" width="0" classCode="1" linkAdd="" order="1" isStat="0" defaultValue="@MEM:defaultTime" fieldSysType="" fixColName="1" isNull="1" planarField="0" subSQL="" repeatNotShow="0" zeroDisplay="0" seriesCol="" seriesNums="" crossField="" groupName="" fieldIdentity="" analysis="0"><Displays><Display localStr="zh_CN" display="签约日期≥"/><Display localStr="en" display="Sign Up Date≥"/><Display localStr="zh_TW" display="簽約日期≥"/></Displays><groupNames/></field><field fieldname="CRMSaleContract.SignUpDate" AsfieldName="endDate" groupByFlag="0" displayFlag="0" condition="&lt;=?" conditionJoin="and" orderbyFlag="" display="签约日期≤" fieldType="5" inputType="0" popUpName="" width="0" classCode="1" linkAdd="" order="2" isStat="0" defaultValue="" fieldSysType="" fixColName="1" isNull="0" planarField="0" subSQL="" repeatNotShow="0" zeroDisplay="0" seriesCol="" seriesNums="" crossField="" groupName="" fieldIdentity="" analysis="0"><Displays><Display localStr="zh_CN" display="签约日期≤"/><Display localStr="en" display="Sign Up Date≤"/><Display localStr="zh_TW" display="簽約日期≤"/></Displays><groupNames/></field><field fieldname="tblDepartment.DeptFullName" AsfieldName="DeptFullName" groupByFlag="1" displayFlag="1" condition="like '%'+?+'%'" conditionJoin="and" orderbyFlag="" display="部门" fieldType="2" inputType="2" popUpName="ReportSelectDepartment" width="80" classCode="1" linkAdd="" order="3" isStat="0" defaultValue="" fieldSysType="" fixColName="1" isNull="0" planarField="0" subSQL="" repeatNotShow="0" zeroDisplay="0" seriesCol="" seriesNums="" crossField="" groupName="" fieldIdentity="" analysis="0"><Displays><Display localStr="zh_CN" display="部门"/><Display localStr="en" display="Department"/><Display localStr="zh_TW" display="部門"/></Displays><groupNames/></field><field fieldname="tblEmployee.EmpFullName" AsfieldName="EmpFullName" groupByFlag="1" displayFlag="1" condition="like '%'+?+'%'" conditionJoin="and" orderbyFlag="" display="业务员" fieldType="2" inputType="2" popUpName="ReportSelectEmployee" width="80" classCode="1" linkAdd="" order="4" isStat="0" defaultValue="" fieldSysType="" fixColName="1" isNull="0" planarField="0" subSQL="" repeatNotShow="0" zeroDisplay="0" seriesCol="" seriesNums="" crossField="" groupName="" fieldIdentity="" analysis="0"><Displays><Display localStr="zh_CN" display="业务员"/><Display localStr="en" display="Employee"/><Display localStr="zh_TW" display="業務員"/></Displays><groupNames/></field><field fieldname="k.TotalAmount" AsfieldName="TotalAmount" groupByFlag="1" displayFlag="1" condition="" conditionJoin="" orderbyFlag="" display="合同金额" fieldType="1" inputType="0" popUpName="" width="100" classCode="1" linkAdd="" order="5" isStat="0" defaultValue="" fieldSysType="" fixColName="1" isNull="0" planarField="0" subSQL="" repeatNotShow="0" zeroDisplay="1" seriesCol="" seriesNums="" crossField="" groupName="" fieldIdentity="" analysis="0"><Displays><Display localStr="zh_CN" display="合同金额"/><Display localStr="en" display="Total Amount"/><Display localStr="zh_TW" display="合同金額"/></Displays><groupNames/></field><field fieldname="k.ReceiveAmount" AsfieldName="ReceiveAmount" groupByFlag="1" displayFlag="1" condition="" conditionJoin="" orderbyFlag="" display="回款金额" fieldType="1" inputType="0" popUpName="" width="100" classCode="1" linkAdd="" order="6" isStat="0" defaultValue="" fieldSysType="" fixColName="1" isNull="0" planarField="0" subSQL="" repeatNotShow="0" zeroDisplay="1" seriesCol="" seriesNums="" crossField="" groupName="" fieldIdentity="" analysis="0"><Displays><Display localStr="zh_TW" display="回款金額"/><Display localStr="zh_CN" display="回款金额"/><Display localStr="en" display="Receive Sale Contract Amount"/></Displays><groupNames/></field><field fieldname="k.NoReceiveAmount" AsfieldName="NoReceiveAmount" groupByFlag="1" displayFlag="1" condition="" conditionJoin="" orderbyFlag="" display="未回款金额" fieldType="1" inputType="6" popUpName="" width="100" classCode="1" linkAdd="" order="7" isStat="0" defaultValue="" fieldSysType="" fixColName="1" isNull="0" planarField="0" subSQL="" repeatNotShow="0" zeroDisplay="1" seriesCol="" seriesNums="" crossField="" groupName="" fieldIdentity="" analysis="0"><Displays><Display localStr="zh_TW" display="未回款金額"/><Display localStr="zh_CN" display="未回款金额"/><Display localStr="en" display="No Receive Sale Contract Amount"/></Displays><groupNames/></field><field fieldname="(case k.TotalAmount when 0 then 0 else k.ReceiveAmount/k.TotalAmount end)" AsfieldName="FinishRate" groupByFlag="1" displayFlag="1" condition="" conditionJoin="" orderbyFlag="降" display="完成率" fieldType="1" inputType="0" popUpName="" width="0" classCode="1" linkAdd="" order="8" isStat="0" defaultValue="" fieldSysType="" fixColName="1" isNull="0" planarField="0" subSQL="" repeatNotShow="0" zeroDisplay="1" seriesCol="" seriesNums="" crossField="" groupName="" fieldIdentity="" analysis="0"><Displays><Display localStr="zh_CN" display="完成率"/><Display localStr="en" display="Finish Rate"/><Display localStr="zh_TW" display="完成率"/></Displays><groupNames/></field><field fieldname="dbo.getdigits('tblStockDet','lastPrice',(case u.EmpNum when 0 then 0 else (case k.TotalAmount when 0 then 0 else k.ReceiveAmount/k.TotalAmount end)/u.EmpNum end))" AsfieldName="AvgFinishRate" groupByFlag="1" displayFlag="0" condition="" conditionJoin="" orderbyFlag="降" display="平均完成率" fieldType="1" inputType="0" popUpName="" width="0" classCode="1" linkAdd="" order="9" isStat="0" defaultValue="" fieldSysType="" fixColName="1" isNull="0" planarField="0" subSQL="" repeatNotShow="0" zeroDisplay="1" seriesCol="" seriesNums="" crossField="" groupName="" fieldIdentity="" analysis="0"><Displays><Display localStr="zh_CN" display="平均完成率"/><Display localStr="en" display="Avg finish Rate"/><Display localStr="zh_TW" display="平均完成率"/></Displays><groupNames/></field><field fieldname="replace(cast(dbo.getdigits('tblStockDet','lastPrice',(case k.TotalAmount when 0 then 0 else k.ReceiveAmount/k.TotalAmount end))*100 as varchar(100))+'%','0%','')" AsfieldName="FinishRateV" groupByFlag="0" displayFlag="1" condition="" conditionJoin="" orderbyFlag="" display="完成率" fieldType="2" inputType="0" popUpName="" width="100" classCode="1" linkAdd="" order="10" isStat="0" defaultValue="" fieldSysType="" fixColName="1" isNull="0" planarField="0" subSQL="" repeatNotShow="0" zeroDisplay="1" seriesCol="" seriesNums="" crossField="" groupName="" fieldIdentity="" analysis="0"><Displays><Display localStr="zh_CN" display="完成率"/><Display localStr="en" display="Finish Rate"/><Display localStr="zh_TW" display="完成率"/></Displays><groupNames/></field><field fieldname="replace(cast(dbo.getdigits('tblStockDet','lastPrice',(case u.EmpNum when 0 then 0 else (case k.TotalAmount when 0 then 0 else k.ReceiveAmount/k.TotalAmount end)/u.EmpNum end))*100 as varchar(100))+'%','0%','')" AsfieldName="AvgFinishRateV" groupByFlag="0" displayFlag="1" condition="CRMSaleContract.workFlowNodeName='finish'" conditionJoin="and" orderbyFlag="" display="平均完成率" fieldType="2" inputType="0" popUpName="" width="100" classCode="1" linkAdd="" order="11" isStat="0" defaultValue="" fieldSysType="" fixColName="1" isNull="0" planarField="0" subSQL="" repeatNotShow="0" zeroDisplay="1" seriesCol="" seriesNums="" crossField="" groupName="" fieldIdentity="" analysis="0"><Displays><Display localStr="zh_CN" display="平均完成率"/><Display localStr="en" display="Avg finish Rate"/><Display localStr="zh_TW" display="平均完成率"/></Displays><groupNames/></field><field fieldname="u.EmpNum" AsfieldName="EmpNum" groupByFlag="1" displayFlag="0" condition="" conditionJoin="" orderbyFlag="" display="员工数" fieldType="1" inputType="0" popUpName="" width="0" classCode="1" linkAdd="" order="12" isStat="0" defaultValue="" fieldSysType="" fixColName="1" isNull="0" planarField="0" subSQL="" repeatNotShow="0" zeroDisplay="0" seriesCol="" seriesNums="" crossField="" groupName="" fieldIdentity="" analysis="0"><Displays><Display localStr="zh_CN" display="员工数"/></Displays><groupNames/></field></fieldInfo><SQL text="select vbCrLf    tblDepartment.DeptFullName as DeptFullName,vbCrLf    tblEmployee.EmpFullName as EmpFullName,vbCrLf    k.TotalAmount as TotalAmount,vbCrLf    k.ReceiveAmount as ReceiveAmount,vbCrLf    k.NoReceiveAmount as NoReceiveAmount,vbCrLf    (case k.TotalAmount when 0 then 0 else k.ReceiveAmount/k.TotalAmount end) as FinishRate,vbCrLf    replace(cast(dbo.getdigits('tblStockDet','lastPrice',(case k.TotalAmount when 0 then 0 else k.ReceiveAmount/k.TotalAmount end))*100 as varchar(100))+'%','0%','') as FinishRateV,vbCrLf    replace(cast(dbo.getdigits('tblStockDet','lastPrice',(case u.EmpNum when 0 then 0 else (case k.TotalAmount when 0 then 0 else k.ReceiveAmount/k.TotalAmount end)/u.EmpNum end))*100 as varchar(100))+'%','0%','') as AvgFinishRateVvbCrLffrom CRMSaleContractvbCrLfleft join tblEmployee on tblEmployee.id=CRMSaleContract.EmployeeIDvbCrLfleft join tblDepartment on tblDepartment.classCode=tblEmployee.DepartmentCodevbCrLfleft join (select a.EmployeeID,a.DepartmentCode,sum(a.TotalAmount) as TotalAmount,sum(a.ReceiveAmount) as ReceiveAmount,vbCrLfsum(a.NoReceiveAmount) as NoReceiveAmount,count(id) as ContractNumvbCrLf from CRMSaleContract a where a.SignUpDate &gt;=(case @condition:startDate when '' then '0001-01-01' else @condition:startDate end) vbCrLfand a.SignUpDate&lt;=(case @condition:endDate when '' then '9999-12-31' else @condition:endDate end)vbCrLfgroup by a.EmployeeID,a.DepartmentCode) k on k.EmployeeID=CRMSaleContract.EmployeeID and k.DepartmentCode=CRMSaleContract.DepartmentCodevbCrLfleft join (select count(n.EmployeeID) as EmpNum from (select distinct EmployeeID from CRMSaleContract a where a.SignUpDate &gt;=(case @condition:startDate when '' then '0001-01-01' else @condition:startDate end) vbCrLfand a.SignUpDate&lt;=(case @condition:endDate when '' then '9999-12-31' else @condition:endDate end)) n) u on 1=1vbCrLfwhere 1=1 vbCrLf      and (CRMSaleContract.SignUpDate &gt;=?)vbCrLf      and (CRMSaleContract.SignUpDate &lt;=?)vbCrLf      and (tblDepartment.DeptFullName like '%'+?+'%')vbCrLf      and (tblEmployee.EmpFullName like '%'+?+'%')vbCrLf      and CRMSaleContract.workFlowNodeName='finish'vbCrLfgroup by vbCrLf   tblDepartment.DeptFullName,vbCrLf   tblEmployee.EmpFullName,vbCrLf   k.TotalAmount,vbCrLf   k.ReceiveAmount,vbCrLf   k.NoReceiveAmount,vbCrLf   (case k.TotalAmount when 0 then 0 else k.ReceiveAmount/k.TotalAmount end),vbCrLf   dbo.getdigits('tblStockDet','lastPrice',(case u.EmpNum when 0 then 0 else (case k.TotalAmount when 0 then 0 else k.ReceiveAmount/k.TotalAmount end)/u.EmpNum end)),vbCrLf   u.EmpNumvbCrLforder by vbCrLf   (case k.TotalAmount when 0 then 0 else k.ReceiveAmount/k.TotalAmount end) desc,vbCrLf   dbo.getdigits('tblStockDet','lastPrice',(case u.EmpNum when 0 then 0 else (case k.TotalAmount when 0 then 0 else k.ReceiveAmount/k.TotalAmount end)/u.EmpNum end)) descvbCrLf  vbCrLf"/><charts/></ReportDataSource>
